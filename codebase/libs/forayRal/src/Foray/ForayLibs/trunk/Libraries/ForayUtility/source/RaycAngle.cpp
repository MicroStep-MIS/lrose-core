//
//
//
//
//

#include <stdio.h>

#include <cmath>

#include "RaycAngle.h"
using namespace std;
using namespace ForayUtility;

const int RaycAngle::scale_    = 10000;
const int RaycAngle::scale360_ = 360 * RaycAngle::scale_;
const int RaycAngle::scale180_ = 180 * RaycAngle::scale_;

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
RaycAngle::RaycAngle(){

    scaleAngle_ = -99;

}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
RaycAngle::RaycAngle(double initAngle){

    setAngle(initAngle);

}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
RaycAngle::~RaycAngle(){


}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
RaycAngle::RaycAngle(const RaycAngle &ra){

    scaleAngle_ = ra.scaleAngle_;

}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
RaycAngle &RaycAngle::operator=(const RaycAngle &ra){

    scaleAngle_ = ra.scaleAngle_;

    return *this;
}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
RaycAngle &RaycAngle::operator=(const double da){

    setAngle(da);

    return *this;
}


//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
RaycAngle &RaycAngle::operator+=(const double da){

    setAngle(value() + da);

    return *this;
}


//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
RaycAngle &RaycAngle::operator-=(const double da){

    setAngle(value() - da);

    return *this;
}



//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
bool RaycAngle::operator==(const RaycAngle &ra) const{

    return scaleAngle_ == ra.scaleAngle_;
}

//////////////////////////////////////////////////////////////////////
//
//
//
// angle1 < angle2 if angle1 is counter-clockwise to angle2.
// 
// angle1 > angle2 if angle1 is clockwise to angle2
//
//////////////////////////////////////////////////////////////////////
bool RaycAngle::operator<(const RaycAngle &ra) const{

    int ccw_scaleAngle = ra.scaleAngle_ - scaleAngle_;

    if (ccw_scaleAngle < 0){
	ccw_scaleAngle += scale360_;
    }

    if (ccw_scaleAngle == 0) return false;

    return ccw_scaleAngle <= scale180_;
}

bool RaycAngle::operator>(const RaycAngle &ra) const{

    int ccw_scaleAngle = ra.scaleAngle_ - scaleAngle_;

    if (ccw_scaleAngle < 0){
	ccw_scaleAngle += scale360_;
    }

    if (ccw_scaleAngle == 0) return false;

    return ccw_scaleAngle > scale180_;
}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
double RaycAngle::value() const{

    return (double)scaleAngle_ / (double)scale_;
}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
double RaycAngle::abs_delta(const RaycAngle &other) const{

    int diff = scaleAngle_ - other.scaleAngle_;

    if(diff < 0){
	diff += scale360_;
    }

    if(diff > scale180_){
	diff = scale360_ - diff;
    }

    return (double)diff / (double)scale_;
}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
void RaycAngle::setAngle(const double da){

    double ra = fmod(da,360.0);

    if(ra < 0.0){
	ra += 360.0;
    }

    scaleAngle_ = (int)((ra * scale_) + .5);
}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
string RaycAngle::csv_full_head(string head) {

    char msg[2048];

    sprintf(msg,"%7s",head.c_str());

    return string(msg);
}

//////////////////////////////////////////////////////////////////////
//
//
//
//////////////////////////////////////////////////////////////////////
string RaycAngle::csv_full_line() {

    char msg[2048];
    
    sprintf(msg,"%7.2f",value());

    return string(msg);
}



