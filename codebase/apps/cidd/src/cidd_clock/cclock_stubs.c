/* *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=* */
/* ** Copyright UCAR (c) 1990 - 2016                                         */
/* ** University Corporation for Atmospheric Research (UCAR)                 */
/* ** National Center for Atmospheric Research (NCAR)                        */
/* ** Boulder, Colorado, USA                                                 */
/* ** BSD licence applies - redistribution and use in source and binary      */
/* ** forms, with or without modification, are permitted provided that       */
/* ** the following conditions are met:                                      */
/* ** 1) If the software is modified to produce derivative works,            */
/* ** such modified software should be clearly marked, so as not             */
/* ** to confuse it with the version available from UCAR.                    */
/* ** 2) Redistributions of source code must retain the above copyright      */
/* ** notice, this list of conditions and the following disclaimer.          */
/* ** 3) Redistributions in binary form must reproduce the above copyright   */
/* ** notice, this list of conditions and the following disclaimer in the    */
/* ** documentation and/or other materials provided with the distribution.   */
/* ** 4) Neither the name of UCAR nor the names of its contributors,         */
/* ** if any, may be used to endorse or promote products derived from        */
/* ** this software without specific prior written permission.               */
/* ** DISCLAIMER: THIS SOFTWARE IS PROVIDED "AS IS" AND WITHOUT ANY EXPRESS  */
/* ** OR IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED      */
/* ** WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.    */
/* *=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=* */
/*
 * cclock_stubs.c - Notify and event callback function stubs.
 * This file was generated by `gxv' from `cclock.G'.
 */

#include <stdio.h>
#include <sys/param.h>
#include <sys/types.h>
#include <xview/xview.h>
#include <xview/panel.h>
#include <xview/textsw.h>
#include <xview/xv_xrect.h>
#include "cclock_ui.h"

#include <Imlib.h>

/*
 * Global object definitions.
 */
cclock_window1_objects	*Cclock_window1;
Colormap cmap;
Drawable can_xid;
Display *dpy;
GC w_gc;
GC b_gc;

#ifdef MAIN

/*
 * Instance XV_KEY_DATA key.  An instance is a set of related
 * user interface objects.  A pointer to an object's instance
 * is stored under this key in every object.  This must be a
 * global variable.
 */
Attr_attribute	INSTANCE;

main(int argc, char **argv)
{
	XColor    rgb_def;
	XColor    rgb_exact;
	XGCValues gcvalues;

	/*
	 * Initialize XView.
	 */
	xv_init(XV_INIT_ARGC_PTR_ARGV, &argc, argv, NULL);
	INSTANCE = xv_unique_key();
	
	/*
	 * Initialize user interface components.
	 * Do NOT edit the object initializations by hand.
	 */
	Cclock_window1 = cclock_window1_objects_initialize(NULL, 0);

	dpy = (Display *) xv_get(Cclock_window1->window1, XV_DISPLAY);
    cmap = DefaultColormap(dpy,DefaultScreen(dpy));

	can_xid = xv_get(canvas_paint_window(Cclock_window1->canvas1),XV_XID);

	XAllocNamedColor(dpy,cmap,"White",&rgb_def,&rgb_exact);
	gcvalues.foreground = rgb_exact.pixel;
	XAllocNamedColor(dpy,cmap,"Black",&rgb_def,&rgb_exact);
	gcvalues.background = rgb_exact.pixel;
	
	w_gc = XCreateGC(dpy,can_xid,(GCForeground | GCBackground),&gcvalues);

	gcvalues.foreground = rgb_exact.pixel;
	b_gc = XCreateGC(dpy,can_xid,(GCForeground | GCBackground),&gcvalues);


	XSetLineAttributes(dpy, w_gc, 3, LineSolid, CapButt, JoinRound);
	

	
	/*
	 * Turn control over to XView.
	 */
	xv_main_loop(Cclock_window1->window1);
	exit(0);
}

#endif


/*
 * Notify callback function for `button1'.
 */
void
go_func(Panel_item item, Event *event)
{
	int i;
	int ht,wd;
	time_t now = time(0) - (time(0) % 86400);

	static ImlibData *imdata = NULL;
	ImlibImage *image;
	FILE *outfile = NULL;
	char pathname[1024];

	cclock_window1_objects *ip = (cclock_window1_objects *) xv_get(item, XV_KEY_DATA, INSTANCE);

	ht = xv_get(Cclock_window1->canvas1,XV_HEIGHT);
	wd = xv_get(Cclock_window1->canvas1,XV_WIDTH);

	if( imdata == NULL) imdata = Imlib_init(dpy);

	for(i=0; i < 720; i++) {


	    XFillRectangle(dpy,can_xid,b_gc,0,0,wd,ht);
	    XUDRdraw_clock(dpy,can_xid,w_gc,(wd/2),(ht/2),(ht/2)-2,now + (i * 60),0);
		XFlush(dpy);

		sprintf(pathname,"CLK_%03d.png",i);
		  image =  Imlib_create_image_from_drawable (imdata, can_xid, can_xid, 0, 0, wd, ht);
		 Imlib_save_image (imdata, image, pathname, NULL);
		 Imlib_destroy_image (imdata, image);

		/* 
		usleep(100000);
		 */
	}
}

